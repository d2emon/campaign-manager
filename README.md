# campaign-manager

Campaign Manager for RPG: Менеджер кампаний для Game Master (GM)

**Описание:**

Приложение для организации игровых сессий: хранение заметок, NPC, локаций, квестов и тайных записей для мастера.

## Фронтэнд

### Основной функционал

1. Древовидная структура кампании
    * Разделы: **Локации**, **Персонажи (NPC)**, **Квесты**, **Арты**, **Заметки**.
    * Возможность создавать вложенные элементы (например, локация → таверна → владелец таверны).
    * Drag-and-drop для переупорядочивания элементов (библиотека react-beautiful-dnd).
2. Редактор для GM-заметок
    * Поддержка **Markdown** (заголовки, списки, таблицы) + превью.
    * Возможность добавлять **тайные заметки** (видимые только GM).
    * Теги для быстрого поиска (например, #магия, #подземелье).
3. Генератор NPC
    * Параметры генерации: раса, профессия, характер (добрый/злой/нейтральный).
    * Автоматическая генерация:
        * Имя (на основе расы: эльфы — «Элрандир», гномы — «Гимли»).
        * Внешность («шрам на щеке», «седые волосы»).
        * Цель («уничтожить гильдию воров», «найти артефакт»).
    * Сохранение NPC в раздел кампании.
4. Интерактивная карта мира
    * Загрузка изображения карты (PNG/JPG/SVG).
    * Добавление меток с описаниями (например, «Логово дракона»).
    * Возможность рисовать пути или области (библиотека leaflet или react-konva).
5. Режим «Только для GM»
    * Пароль или PIN-код для доступа к скрытым разделам.
    * Переключение между «режимом GM» и «режимом игрока» (например, чтобы показывать игрокам только карту без спойлеров).

### Стек технологий

* React + TypeScript (для типизации данных кампании).
* Redux Toolkit / Zustand — управление состоянием (данные кампании, заметки, NPC).
* React Router — навигация между разделами.
* Firebase Firestore — хранение данных и синхронизация между устройствами.
* react-markdown / MDX — рендеринг Markdown.
* Leaflet / react-simple-maps — интерактивные карты.
* Framer Motion — анимации интерфейса.
* IndexedDB — оффлайн-доступ (через библиотеку idb).

### Интерфейс

* Главный экран:
  * Боковое меню с разделами кампании (локации, NPC, квесты).
  * Панель быстрого доступа к генератору NPC и карте.
  * Кнопка переключения между режимами GM/игрок.
* Страница локации:
  * Древовидная структура подлокаций.
  * Вкладки: описание, связанные NPC, квесты.
  * Кнопка «Добавить тайную заметку».
* Карта мира:
  * Полноэкранный режим.
  * Инструменты для добавления меток и рисования.
  * Легенда с фильтрами (показать только города, подземелья и т.д.).

### Бонусные фичи

* Темная тема в стиле «старинной карты» (пергаментный фон, шрифты с засечками).
* Шаблоны кампаний (например, «Тёмное подземелье», «Политический заговор»).
* Таймер сессии с уведомлением («Прошло 3 часа! Пора сделать перерыв»).
* Импорт/экспорт данных в JSON для переноса кампаний.
* Синхронизация в реальном времени через Firebase (если GM и игроки открыли одну кампанию).

#### Подумать над реализацией

* Интеграция с D&D 5e API (например, Open5e).
* Голосовой помощник (Web Speech API) для GM: "Алиса, добавь гоблина в трекер!".
* 3D-визуализация персонажей через Three.js.

### Как начать

1. Создайте базовую структуру
    * Настройте React + TypeScript.
    * Добавьте Redux Toolkit для хранения данных кампании.
    * Сделайте простой интерфейс с боковым меню.
2. Реализуйте генератор NPC
    * Подготовьте JSON-файлы с вариантами имен, черт характера и целей.
    * Создайте UI для выбора параметров и отображения результата.
3. Добавьте редактор Markdown
    * Используйте react-markdown для превью.
    * Сохраняйте заметки в состоянии Redux.
4. Интегрируйте карту
    * Начните с простого SVG и меток, потом переходите к Leaflet.
5. Добавьте аутентификацию GM
    * Простой пароль через localStorage.

## Бэкэнд

### Стек технологий бэкендов

* Node.js + Express.js (REST API или GraphQL).
* MongoDB (база данных для хранения кампаний, NPC, карт) + Mongoose (ODM).
* Socket.io (реальная синхронизация между GM и игроками).
* JWT (аутентификация GM и игроков).
* Swagger (документация API).
* Nodemailer (отправка приглашений в кампанию по email).
* Jest / Supertest (тестирование).

### Схема API (основные эндпоинты)

1. Аутентификация и пользователи:
    * POST /api/auth/register — регистрация GM.
    * POST /api/auth/login — вход (возвращает JWT токен).
    * POST /api/auth/forgot-password — восстановление пароля.
2. Кампании:
    * GET /api/campaigns — список кампаний GM.
    * POST /api/campaigns — создать кампанию.
    * GET /api/campaigns/:id — получить данные кампании (локации, NPC, квесты).
    * PUT /api/campaigns/:id — обновить кампанию.
    * DELETE /api/campaigns/:id — удалить кампанию.
3. Контент (NPC/локации/квесты):
    * POST /api/campaigns/:id/npc — добавить NPC в кампанию.
    * GET /api/npc/generate — сгенерировать случайного NPC (раса, класс, черты).
    * POST /api/campaigns/:id/map — загрузить карту кампании.
    * POST /api/campaigns/:id/notes — добавить GM-заметку (Markdown).
4. Режим реального времени:
    * WebSocket-эндпоинт (/socket.io) для синхронизации:
        * Обновление позиций на карте.
        * Изменение HP персонажей в бою.
        * Чат между GM и игроками.

### Интеграция с фронтендом (React)

1. Настройка CORS в Express, чтобы React-фронтенд мог подключаться к API.
2. HTTP-клиент: используйте axios или fetch для запросов к бэкенду.
3. Сокеты: подключите React-приложение к Socket.io для реального времени.
4. JWT-токен: сохраняйте в localStorage или cookies, добавляйте в заголовок Authorization.

### Советы по безопасности

1. Валидация данных: используйте библиотеку Joi или validator.js для проверки входящих запросов.
2. Защита роутов: middleware для проверки JWT и ролей (например, только GM может удалять кампании).
3. Шифрование паролей: bcrypt.js для хеширования.
4. Ограничение запросов: express-rate-limit для защиты от DDoS.

### Развертывание

1. Докеризация:
    * Dockerfile для Node.js-приложения.
    * Образ MongoDB в docker-compose.yml.
2. Хостинг:
    * Backend: Heroku, DigitalOcean, или AWS EC2.
    * База данных: MongoDB Atlas (облачная версия).
3. GitHub Actions или GitLab CI/CD для автоматического деплоя.

### Потенциальные улучшения

* ИИ-генерация контента:
  * Интеграция с OpenAI API для генерации описаний NPC/квестов.
  * Пример: «Напиши историю о древнем проклятии для D&D».
* Discord-бот:
  * Уведомления о новых сессиях прямо в Discord.
  * Синхронизация заметок с каналом GM.
* Экспорт в Obsidian.md — популярный инструмент для RPG-мастеров.

## План разработки проекта

Рассчитан на 8-12 недель (гибко, в зависимости от времени разработчика).

**Цель:** поэтапно создать MVP с основным функционалом, затем добавить бонусные фичи.

### Этап 0: Подготовка (1 неделя)

1. Определение требований
    * Составление списка основных и дополнительных функций (на основе предыдущих обсуждений).
    * Приоритизация: что войдет в MVP, что отложить на потом.
2. Дизайн-макеты
    * Наброски интерфейса в Figma/Canva (главный экран, страница NPC, карта).
    * Выбор цветовой схемы и шрифтов (например, "пергаментный стиль").
3. Выбор стека и настройка окружения
    * Создать репозитории для фронтенда (React) и бэкенда (Node.js).
    * Установить MongoDB, настроить Docker (если используется).

### Этап 1: Бэкенд (2-3 недели)

**Цель:** Реализовать базовое API для работы с кампаниями, NPC и аутентификацией.

#### Неделя 1

* Настройка Express.js + MongoDB.
* Создать схемы данных для:
  * Пользователи (GM и игроки).
  * Кампании (название, описание, GM).
  * NPC (имя, раса, описание).
* Реализовать аутентификацию (JWT):
  * Регистрация, вход, восстановление пароля.

#### Неделя 2

* API для CRUD операций:
  * Создание/редактирование кампании.
  * Добавление/удаление NPC.
  * Заметки (Markdown-контент).
* Генератор NPC:
  * Роут /api/npc/generate, возвращающий случайного NPC.

#### Неделя 3 (опционально)

* Интеграция Socket.io для реального времени.
* Настройка MongoDB Atlas (облачная база).
* Написать тесты для API (Jest + Supertest).

### Этап 2: Фронтенд (4-5 недель)

**Цель:** Реализовать интерфейс для управления кампаниями и NPC.

#### Неделя 4

* Настройка React + Redux Toolkit / Zustand.
* Страницы:
  * Логин / Регистрация.
  * Список кампаний.
* Интеграция с бэкендом:
  * Запросы к /api/campaigns.

#### Неделя 5

* Страница создания/редактирования кампании:
  * Форма с полями: название, описание.
  * Drag-and-drop для структуры (локации, NPC).
* Базовый интерфейс для добавления NPC.

#### Неделя 6

* Генератор NPC:
  * Форма выбора расы, профессии.
  * Отображение сгенерированного NPC (анимации через Framer Motion).
* Редактор Markdown:
  * Вкладка "Заметки" с превью.

#### Неделя 7

* Интерактивная карта:
  * Загрузка изображения карты.
  * Добавление меток (интеграция с Leaflet).
* Режим GM/игрок:
  * Переключатель в хедере, скрытие секретных данных.

### Этап 3: Интеграция и тестирование (1-2 недели)

**Цель:** Связать фронтенд и бэкенд, проверить работу системы.

1. Интеграция API:
    * Настроить CORS, подключить axios-запросы.
    * Обработка ошибок (например, "Кампания не найдена").
2. Тестирование:
    * Ручное тестирование всех сценариев:
      * Создание кампании → Добавление NPC → Генерация контента.
    * Проверка синхронизации через Socket.io (если реализовано).
3. Исправление багов:
    * Оптимизация производительности (например, ленивая загрузка карт).
    * Фикс проблем с аутентификацией.

### Этап 4: Деплой и документация (3-5 дней)

1. Деплой бэкенда:
    * Выбор хостинга (Heroku, DigitalOcean).
    * Настройка домена, SSL-сертификата.
2. Деплой фронтенда:
    * Сборка проекта через npm run build.
    * Хостинг на Vercel/Netlify.
3. Документация:
    * README.md с инструкцией по запуску.
    * Swagger-документация для API.

### Этап 5: Бонусные фичи (по желанию)

Добавить после MVP:

* Темная тема (1-2 дня).
* Импорт/экспорт кампаний в JSON (3-4 дня).
* Интеграция с OpenAI для генерации квестов (1 неделя).
* Мобильная версия (React Native, 2-3 недели).

### Советы

* Используйте Trello/Jira для трекинга задач.
* Коммитьте часто с понятными сообщениями:
* Не оптимизируйте prematurely — сначала работающий MVP, потом рефакторинг.

### Пример расписания (8 недель)

|Неделя |Этап       |Задачи |
|-------|-----------|-------|
|1      |Подготовка |Макеты, настройка окружения, схемы данных.|
|2-3    |Бэкенд     |API для кампаний, NPC, аутентификация.|
|4-7    |Фронтенд   |Интерфейс кампаний, генератор NPC, карта.|
|8      |Тестирование + деплой  |Исправление багов, деплой на хостинг, документация.|

## Развитие

### Генератор персонажей с автоматическим расчетом характеристик

**Описание:**

Интерактивный конструктор для создания персонажей по правилам D&D 5e или других систем. Пользователи выбирают расу, класс, распределяют характеристики, а приложение автоматически рассчитывает модификаторы, навыки и бонусы.

**Основной функционал:**

* Выбор расы, класса, предыстории из выпадающих списков (данные можно хранить в JSON).
* Распределение очков характеристик (Strength, Dexterity и т.д.) с подсчетом модификаторов.
* Автоматическое добавление навыков, владений оружием/доспехами на основе класса.
* Визуальная карточка персонажа в стиле D&D (можно экспортировать в PDF).
* Сохранение персонажей в локальном хранилище или через Firebase.

**Стек:**

* React Hook Form + Yup для валидации.
* PDF-lib для генерации PDF-карточек.

### Боевой трекер (Combat Tracker)

**Описание:**

Инструмент для отслеживания инициативы, HP, статусов существ в бою. Помогает GM не запутаться в большом сражении.

**Основной функционал:**

* Добавление участников боя (игроки и враги) с их инициативой и HP.
* Автоматическая сортировка по инициативе (включая одинаковые значения через d20).
* Визуальная лента ходов с подсветкой текущего участника.
* Быстрое изменение HP (двойной клик для редактирования).
* Накладывание статусов (например, "Отравлен", "Невидимый") с иконками.

**Стек:**

* React DnD для перетаскивания участников.
* react-icons для визуализации статусов.

### Генератор случайных квестов/событий

**Описание:**

Помогает GM быстро создать заготовку для приключения: цель, антагонист, препятствия, награда.

**Основной функционал:**

* Выбор шаблона ("Спасение", "Поиск артефакта", "Уничтожение угрозы").
* Генерация случайных элементов:
  * Антагонист (например, "одержимый маг", "банда гоблинов").
  * Локация ("заброшенный храм", "подземелье с ловушками").
  * Награда ("магический меч", "древний свиток").
* Возможность сохранять сгенерированные квесты в "Избранное".
* Режим "Случайный квест одной кнопкой".

**Стек:**

* JSON с массивами данных (антагонисты, локации и т.д.).
* Material-UI для быстрого прототипирования.
* Поделиться квестом в Twitter/Discord (Web Share API).
